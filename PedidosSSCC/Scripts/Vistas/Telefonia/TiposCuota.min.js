$(document).ready(async function(){function u(){e();o();f()}function f(){$("#btnNuevo").on("click",s);$("#btnGuardar").on("click",a);$("#btnBuscar").on("click",function(){let n=$("#tableTiposCuota").DataTable();n.columns(0).search($("#filterCuota").val()).draw();n.columns(1).search($("#filterDepartamento").val()).draw();n.columns(2).search($("#filterSede").val()).draw();n.columns(3).search($("#filterUso").val()).draw();i()});$("#formBuscar").on("keyup input",function(){let n=$("#tableTiposCuota").DataTable();n.search(this.value,!1,!1).draw();i()})}function e(){let t=localStorage.getItem(n);if(t)try{const n=JSON.parse(t);$("#formBuscar").val(n.general||"");$("#filterCuota").val(n.cuota||"");$("#filterDepartamento").val(n.departamento||"");$("#filterSede").val(n.sede||"");$("#filterUso").val(n.uso||"");(n.cuota||n.departamento||n.sede||n.uso)&&($("#btnLimpiar").show(),$(".table-filter").addClass("advance"),$("#btnAvanzado").html(`Ocultar Filtros`))}catch{}}function i(){const t={general:$("#formBuscar").val(),cuota:$("#filterCuota").val(),departamento:$("#filterDepartamento").val(),sede:$("#filterSede").val(),uso:$("#filterUso").val()};localStorage.setItem(n,JSON.stringify(t))}function o(){t=inicializarDataTable("#tableTiposCuota",{ajax:{url:AppConfig.urls.ObtenerTiposCuota,type:"GET",dataSrc:""},columns:[{data:"TCU_Cuota",title:"Cuota"},{data:"TCU_Departamento",title:"Departamento"},{data:"TCU_Sede",title:"Sede"},{data:"TCU_Uso",title:"Uso"},{data:null,className:"td-btn",orderable:!1,title:'<span class="sReader">Acción<\/span>',render:function(n,t,i){const r=JSON.stringify(i).replace(/"/g,"&quot;");return`
                        <div class="btn-group" role="group">
                            <button class="btn btn-icon me-2 btn-editar" data-row="${r}" title="Editar">
                                <i class="bi bi-pencil-square"></i>
                            </button>
                            <button class="btn btn-icon btn-eliminar" data-row="${r}" title="Eliminar">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>`}}],initComplete:function(){const i=localStorage.getItem(n);if(i){const n=JSON.parse(i);n?.general&&t.search(n.general,!1,!1).draw()}}},[],"export_tiposcuota");$("#tableTiposCuota").on("click",".btn-editar",function(){const n=JSON.parse($(this).attr("data-row").replace(/&quot;/g,'"'));h(n)});$("#tableTiposCuota").on("click",".btn-eliminar",function(){const n=JSON.parse($(this).attr("data-row").replace(/&quot;/g,'"'));c(n)});$(window).resize(function(){t.columns.adjust().draw()})}function s(){r();$("#modalEditarLabel").text("Agregar Tipo de Cuota");$("#modalEditar").modal("show")}function h(n){r();$("#idTipoCuota").val(n.TCU_Id);$("#cuota").val(n.TCU_Cuota);$("#departamento").val(n.TCU_Departamento);$("#sede").val(n.TCU_Sede);$("#uso").val(n.TCU_Uso);$("#modalEditarLabel").text("Editar Tipo de Cuota");$("#modalEditar").modal("show")}function c(n){mostrarAlertaConfirmacion({titulo:`¿Eliminar el tipo de cuota '${htmlEscape(n.TCU_Cuota)}'?`,onConfirmar:async()=>{try{const t=await $.ajax({url:AppConfig.urls.EliminarTipoCuota,method:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({id:n.TCU_Id}),dataType:"json"});t.success?(mostrarToast(AppConfig.mensajes.operacionOk,TipoToast.Success),$("#tableTiposCuota").DataTable().ajax.reload(null,!1)):mostrarToast(t.message||"No se pudo eliminar.",TipoToast.Warning)}catch(t){registrarErrorjQuery("Eliminar",t.message||t)}}})}function l(){let n=!0;return["cuota","departamento","sede","uso"].forEach(t=>{const i=$("#"+t);i.val()?i.removeClass("is-invalid"):(i.addClass("is-invalid"),n=!1)}),n||mostrarToast(AppConfig.mensajes.camposObligatorios,TipoToast.Warning),n}async function a(){if(l()){const t={TCU_Id:parseInt($("#idTipoCuota").val()||"0"),TCU_Cuota:$("#cuota").val().trim(),TCU_Departamento:$("#departamento").val().trim(),TCU_Sede:$("#sede").val().trim(),TCU_Uso:$("#uso").val().trim()};try{const n=await $.ajax({url:AppConfig.urls.GuardarTipoCuota,method:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),dataType:"json"});n.success?(mostrarToast(AppConfig.mensajes.operacionOk,TipoToast.Success),$("#modalEditar").modal("hide"),$("#tableTiposCuota").DataTable().ajax.reload(null,!1)):mostrarToast(n.message||"Error al guardar.",TipoToast.Warning)}catch(n){registrarErrorjQuery("Guardar",n.message||n)}}}function r(){$("#idTipoCuota").val("");$("#cuota, #departamento, #sede, #uso").val("").removeClass("is-invalid")}await VerificarSesionActiva(OpcionMenu.TiposCuota);const n="Filtros.TiposCuota";let t;await u();ocultarDivCargando()});