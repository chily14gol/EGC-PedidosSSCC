async function verConcepto(n){try{const i=await fetch(AppConfig.urls.ObtenerConceptoDetalle+"?idConcepto="+n);if(!i.ok)throw new Error(`Error en la respuesta del servidor: ${i.status}`);const t=await i.json();$("#idConcepto").val(t.TLE_Id);$("#solicitante").val(t.Solicitante);$("#fechaSolicitud").val(t.FechaModificacion);$("#tareaEmpresa").val(t.TareaNombre+" - "+t.EmpresaNombre);$("#descripcionModal").val(t.TLE_Descripcion);let r=parseFloat(t.TLE_Cantidad)||0,u=parseFloat(t.TAR_ImporteUnitario)||0;const f=3;let e;e=t.TAR_TTA_Id===f?r:r*u;$("#cantidadModal").val(formatNumber(r));$("#importeUnitarioModal").val(formatNumber(u));$("#importeTotalModal").val(formatNumber(e));t.TAR_TTA_Id===f?$(".filaImporteYCantidad").hide():$(".filaImporteYCantidad").show();$("#modalEditar").modal("show")}catch(t){const n=obtenerMensajeErrorAjax(t);registrarErrorjQuery(t.status,n)}}$(document).ready(function(){async function r(){mostrarDivCargando();let n=localStorage.getItem(t),i=!1;if(n){n=JSON.parse(n);$("#formBuscar").val(n.general);$("#filterTarea").val(n.tarea||"");$("#filterEmpresa").val(n.empresa||"");$("#filterCantidad").val(n.cantidad||"");$("#filterImporte").val(n.importe||"");$("#filterDescripcion").val(n.descripcion||"");let{...otrosFiltros}=n;i=Object.values(otrosFiltros).some(n=>n!==""&&n!==null&&n!==undefined)}await u();setTimeout(function(){let t=$("#tablaConceptosPendientes").DataTable();n?.general&&t.search(n.general,!1,!1).draw()},200);i&&($("#btnLimpiar").show(),$(".table-filter").addClass("advance"),$("#btnAvanzado").html(`Ocultar Filtros`))}function i(){let n=$("#formBuscar").val(),i=$("#filterTarea").val(),r=$("#filterEmpresa").val(),u=$("#filterCantidad").val(),f=$("#filterImporte").val(),e=$("#filterDescripcion").val(),o={general:n,tarea:i,empresa:r,cantidad:u,importe:f,descripcion:e};localStorage.setItem(t,JSON.stringify(o))}async function u(){try{mostrarDivCargando();let n=inicializarDataTable("#tablaConceptosPendientes",{ajax:{url:AppConfig.urls.ObtenerConceptosPendienteAprobacion,type:"GET",dataSrc:"",dataType:"json"},columns:[{className:"col-checkbox",data:null,title:'<input type="checkbox" id="selectAll" class="form-check-input">',orderable:!1,searchable:!1,render:function(n,t,i){return`<input type="checkbox" class="row-checkbox form-check-input" value="${i.TLE_Id}">`}},{data:"TareaNombre",title:"Tarea"},{data:"EmpresaNombre",title:"Empresa"},{data:"CantidadNombre",title:"Cantidad",className:"dt-type-numeric-with-decimal"},{data:"ImporteTotal",title:"Importe",className:"dt-type-numeric-with-decimal",render:function(n){return formatMoney(n)}},{data:"TLE_Descripcion",title:"Descripción"},{className:"td-btn",data:null,title:'<span class="sReader">Acción<\/span>',responsivePriority:2,orderable:!1,render:function(n,t,i){return`<button type="button" class="btn btn-icon btn-detalle btn-outline-secondary" onclick="verConcepto(${i.TLE_Id})">
                                                <i class="bi bi-eye" title="Ver"></i>
                                            </button>`}}],initComplete:function(){const n=this.api(),t=n.rows().count();t===0?($("#mensaje-bienvenida").show(),$("#div-tablaConceptos").hide()):($("#mensaje-bienvenida").hide(),$("#div-tablaConceptos").show());ocultarDivCargando()}},[],"export_conceptos");$(window).on("resize",function(){n.columns.adjust();n.responsive.recalc();n.draw()});$("#formBuscar").on("keyup input",function(){n.search(this.value,!1,!1).draw();n.responsive.rebuild();n.responsive.recalc();n.columns.adjust();n.draw(!1);i()})}catch(n){ocultarDivCargando()}}async function f(){try{const n=await fetch(AppConfig.urls.ObtenerTareas),t=await n.json()}catch(n){}}async function e(){try{const n=await fetch(AppConfig.urls.ObtenerConceptosFacturacion),t=await n.json()}catch(n){}}async function o(){try{const n=await fetch(AppConfig.urls.ObtenerPedidos),t=await n.json()}catch(n){}}function n(n,t,i,r=null){let u=r||[$("#idConcepto").val()],f=$("#comentarios").val()||"";$.ajax({url:AppConfig.urls.AprobarRechazarConceptos,type:"POST",contentType:"application/json",data:JSON.stringify({ids:u,comentarios:f,idEstado:n}),success:function(n){n.success?(n.ok_email||(sessionStorage.setItem("toastMensaje",n.mensaje_email),sessionStorage.setItem("toastTipo","error"),sessionStorage.setItem("errorEmail",!0)),Swal.fire({title:t,text:i,icon:"success",confirmButtonColor:"#28a745"}).then(()=>{location.reload()})):registrarErrorjQuery("",n.message)},error:function(n){const t=obtenerMensajeErrorAjax(n);registrarErrorjQuery(n.status,t)}})}let t=Filtros.Tareas;VerificarSesionActiva(OpcionMenu.Inicio).then(async()=>{await r(),f(),e(),o()});$("#tablaConceptosPendientes thead").on("change","#selectAll",function(){let n=this.checked;$(".row-checkbox").prop("checked",n)});$("#btnAprobar").on("click",function(){let t=$(".row-checkbox:checked").map(function(){return $(this).val()}).get();if(t.length===0){mostrarToast(AppConfig.mensajes.conceptosAprobar,TipoToast.Warning);return}n(EstadosSolicitud.Aprobado,AppConfig.mensajes.conceptosAprobados,"",t)});$("#btnRechazar").on("click",function(){let t=$(".row-checkbox:checked").map(function(){return $(this).val()}).get();if(t.length===0){mostrarToast("Selecciona al menos un concepto para rechazar",TipoToast.Warning);return}n(EstadosSolicitud.Rechazado,AppConfig.mensajes.conceptosRechazados,"",t)});$("#btnAprobar2").on("click",function(){$("#btnAprobar").click()});$("#btnRechazar2").on("click",function(){$("#btnRechazar").click()});$("#btnAprobarIndividual").on("click",function(){n(EstadosSolicitud.Aprobado,"¡Concepto Aprobado!","")});$("#btnRechazarIndividual").on("click",function(){n(EstadosSolicitud.Rechazado,"¡Concepto Rechazado!","")});$("#btnBuscar").on("click",function(){let t=$("#filterTarea").val(),r=$("#filterEmpresa").val(),u=$("#filterCantidad").val(),f=$("#filterImporte").val(),e=$("#filterDescripcion").val(),n=$("#tablaConceptosPendientes").DataTable();n.columns(1).search(t).draw();n.columns(2).search(r).draw();n.columns(3).search(u).draw();n.columns(4).search(f).draw();n.columns(5).search(e).draw();i()})});