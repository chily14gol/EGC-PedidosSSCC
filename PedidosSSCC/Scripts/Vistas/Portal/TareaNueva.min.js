$(async function(){async function t({selector:t,url:r,placeholder:n,value:u,text:i}){const f=$(t);try{const t=await $.ajax({url:r,type:"GET",dataType:"json"});f.empty().append(`<option value="">${n}</option>`);for(const n of t)f.append(`<option value="${n[u]}">${n[i]}</option>`)}catch(e){const n=obtenerMensajeErrorAjax(e);registrarErrorjQuery(e.status,n);throw n;}}function i(){const t=[{sel:"#nombre",label:"Nombre"},{sel:"#seccion",label:"Sección"},{sel:"#tipo",label:"Tipo"},{sel:"#iva",label:"IVA"},{sel:"#producto",label:"Producto"},{sel:"#itemNumber",label:"Item Number"}],n=[];for(const{sel:i,label:r}of t)$(i).val()?$(i).removeClass("is-invalid"):($(i).addClass("is-invalid"),n.push(r));return($(".campo-importeUnitario").is(":visible")&&($("#importeUnitario").val()?$("#importeUnitario").removeClass("is-invalid"):($("#importeUnitario").addClass("is-invalid"),n.push("Importe Unitario"))),$(".campo-unidad").is(":visible")&&($("#unidad").val()?$("#unidad").removeClass("is-invalid"):($("#unidad").addClass("is-invalid"),n.push("Unidad"))),n.length)?(mostrarToast(AppConfig.mensajes.camposObligatorios+n.join(", "),TipoToast.Warning),!1):!0}try{await VerificarSesionActiva(OpcionMenu.Tareas);const n=[{selector:"#seccion",url:AppConfig.urls.ObtenerComboSecciones,placeholder:"Seleccione Sección",value:"SEC_Id",text:"SEC_Nombre"},{selector:"#tipo",url:AppConfig.urls.CargarComboTiposTarea,placeholder:"Seleccione Tipo",value:"TTA_Id",text:"TTA_Nombre"},{selector:"#unidad",url:AppConfig.urls.ObtenerComboUnidades,placeholder:"Seleccione Unidad",value:"UTI_UTA_Id",text:"UTI_Nombre"},{selector:"#producto",url:AppConfig.urls.ObtenerComboProductosD365,placeholder:"Seleccione Producto",value:"PR3_Id",text:"PR3_Nombre"},{selector:"#itemNumber",url:AppConfig.urls.ObtenerComboItemNumber,placeholder:"Seleccione Item Number",value:"IN3_Id",text:"IN3_Nombre"}];await Promise.all(n.map(n=>t(n)));ocultarDivCargando()}catch(n){console.error("Error al cargar los datos:",n)}$("#tipo").on("change",()=>{const n=$("#tipo").val(),i=n===Tipo.POR_HORAS,t=n===Tipo.POR_UNIDADES;$(".campo-importeUnitario").toggle(i||t);$(".campo-unidad").toggle(t)});$("#btnGuardar").on("click",async n=>{if(n.preventDefault(),i()){const r={TAR_Nombre:$("#nombre").val(),TAR_SEC_Id:$("#seccion").val(),TAR_TTA_Id:$("#tipo").val(),TAR_TipoIva:$("#iva").val(),TAR_ImporteUnitario:$("#importeUnitario").val(),TAR_UTA_Id:$("#unidad").val(),TAR_PR3_Id:$("#producto").val(),TAR_IN3_Id:$("#itemNumber").val(),TAR_Activo:$("#visible").is(":checked")};try{const n=await $.ajax({url:AppConfig.urls.GuardarTarea,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(r)});n.success?(mostrarToast(AppConfig.mensajes.operacionOk,TipoToast.Success),window.location.href=`TareaDetalle/${n.idNuevo}`):mostrarToast("Ocurrió un error al guardar los datos.",TipoToast.Error)}catch(t){const n=obtenerMensajeErrorAjax(t);registrarErrorjQuery(t.status,n)}}});$("#btnCancelar").on("click",n=>{n.preventDefault(),window.location.href=AppConfig.urls.BusquedaTareas})});