$(document).ready(async function(){function t(){return $.getJSON(AppConfig.urls.obtenerDepartamentos).then(n=>{let t=$("#selectDepartamento").empty().append('<option value="">Seleccione<\/option>');n.forEach(n=>t.append(`<option value="${n.DEP_Id}">${n.DEP_Nombre}</option>`))})}await VerificarSesionActiva(OpcionMenu.Personas);let n=$("#tablePersonas").DataTable({ajax:{url:AppConfig.urls.obtenerPersonas,type:"GET",dataSrc:""},columns:[{data:"NombreCompleto",title:"Nombre completo"},{data:"DepartamentoNombre",title:"Departamento"},{data:"PER_Email",title:"Email"},{className:"dt-center ico-status",data:null,title:"Activo",orderable:!1,render:function(n,t,i){return`<input type="checkbox" class="form-check-input"
                            data-id="${i.PER_Id}" disabled
                            ${i.PER_Activo?"checked":""} />`}},{className:"td-btn",data:null,title:'<span class="sReader">Acción<\/span>',orderable:!1,responsivePriority:2,render:(n,t,i)=>`
                    <button class="btn btn-icon btn-editar btn-outline-secondary" onclick="editarPersona(${i.PER_Id}, '${i.PER_Nombre}', '${i.PER_Apellido1}', '${i.PER_Apellido2}', ${i.DepartamentoId}, '${i.PER_Email}', ${i.PER_Activo})">
                        <i class="bi bi-pencil-square" title="Editar"></i>
                    </button>
                    <button class="btn btn-icon btn-eliminar btn-outline-secondary" onclick="eliminarPersona(${i.PER_Id}, '${i.NombreCompleto}')">
                        <i class="bi bi-trash" title="Eliminar"></i>
                    </button>`}],responsive:!0});ocultarDivCargando();$("#btnNuevo").click(()=>{$("#modalEditarPersonaLabel").text("Agregar Persona"),$("#personaIdOriginal").val(""),$(".form-wrapper input, .form-wrapper select").val(""),$("#checkActivo").prop("checked",!0),t().then(()=>$("#modalEditarPersona").modal("show"))});window.editarPersona=(n,i,r,u,f,e,o)=>{$("#modalEditarPersonaLabel").text("Editar Persona"),$("#personaIdOriginal").val(n),$("#inputNombre").val(i),$("#inputApellido1").val(r),$("#inputApellido2").val(u),$("#inputEmail").val(e),$("#checkActivo").prop("checked",o),t().then(()=>{$("#selectDepartamento").val(f),$("#modalEditarPersona").modal("show")})};window.eliminarPersona=(t,i)=>{mostrarAlertaConfirmacion({titulo:`¿Eliminar a '${i}'?`,onConfirmar:()=>{$.post(AppConfig.urls.eliminarPersona,{id:t}).done(t=>{t.success?(mostrarToast("Persona eliminada.",TipoToast.Success),n.ajax.reload(null,!1)):mostrarToast("No se pudo eliminar.",TipoToast.Warning)})}})};$("#btnGuardarPersona").click(()=>{let t={PER_Id:parseInt($("#personaIdOriginal").val())||0,PER_Nombre:$("#inputNombre").val().trim(),PER_Apellido1:$("#inputApellido1").val().trim(),PER_Apellido2:$("#inputApellido2").val().trim(),PER_DEP_Id:parseInt($("#selectDepartamento").val())||null,PER_Email:$("#inputEmail").val().trim(),PER_Activo:$("#checkActivo").is(":checked")};if(!t.PER_Nombre||!t.PER_Apellido1||!t.PER_DEP_Id||!t.PER_Email){mostrarToast("Todos los campos (*) son obligatorios.",TipoToast.Warning);return}$.ajax({url:AppConfig.urls.guardarPersona,type:"POST",contentType:"application/json",data:JSON.stringify(t),success:t=>{t.success?(mostrarToast("Guardado con éxito.",TipoToast.Success),$("#modalEditarPersona").modal("hide"),n.ajax.reload(null,!1)):mostrarToast("Error al guardar.",TipoToast.Error)}})});$("#formBuscar").on("keyup",()=>{n.search($("#formBuscar").val(),!1,!1).draw()});$("#btnBuscar").click(()=>{n.columns(0).search($("#filterNombre").val()).columns(1).search($("#filterApellido").val()).columns(2).search($("#filterDepto").val()).draw()});$("#btnLimpiar").click(()=>{$(".table-filter input").val(""),n.search("").columns().search("").draw(),$("#btnLimpiar").hide()});$("#btnAvanzado").click(()=>{$(".table-filter").toggleClass("advance"),$("#btnLimpiar").toggle(),$("#btnAvanzado").text($(".table-filter").hasClass("advance")?"Ocultar Filtros":"Búsqueda Avanzada")})});