function validarNumero(n){n.value=n.value.replace(/[^0-9]/g,"")}function validarImporte(n){let t=n.value;t=t.replace(/[^0-9\-,]/g,"");t=t.replace(/-/g,"");n.value.startsWith("-")&&(t="-"+t);let i=t.split(",");i.length>2&&(t=i[0]+","+i.slice(1).join(""));n.value=t}function validarEmail(n){var t=new RegExp("^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$");n.style.borderColor=t.test(n.value.trim())?"green":"red"}function validarCIF(n){var t=n.value.trim().toUpperCase(),o;const i=$("#cif"),r=$("#error-cif");if(!/^[A-HJNPQRSUVW]{1}[0-9]{7}[A-J0-9]{1}$/.test(t))return i.addClass("is-invalid"),r.removeClass("d-none"),!1;let u=0;u+=parseInt(t[2])+parseInt(t[4])+parseInt(t[6]);for(let n=1;n<=7;n+=2){let i=(parseInt(t[n])*2).toString();u+=i.length>1?parseInt(i[0])+parseInt(i[1]):parseInt(i)}let f=(10-u%10)%10,e=t[8];if(/[NPQRSW]/.test(t[0]))return"JABCDEFGHI"[f]===e;o=f.toString()===e;i.removeClass("is-valid is-invalid");o?(i.addClass("is-valid"),r.addClass("d-none")):(i.addClass("is-invalid"),r.removeClass("d-none"))}function formatNumber(n){return parseFloat(n).toFixed(2).replace(".",",").replace(/\B(?=(\d{3})+(?!\d))/g,".")}function formatMoney(n){if(!n||isNaN(n))return"0,00 €";let i=parseFloat(n.toString().replace(/[^\d,.-]/g,"").replace(",","."));if(isNaN(i))return"0,00 €";let r=i.toFixed(2).split("."),t=r[0],u=r[1];return t=t.replace(/\B(?=(\d{3})+(?!\d))/g,"."),t+","+u+" €"}function formatPorcentaje(n){if(!n||isNaN(n))return"0,00 %";let i=parseFloat(n.toString().replace(/[^\d,.-]/g,"").replace(",","."));if(isNaN(i))return"0,00 %";let r=i.toFixed(2).split("."),t=r[0],u=r[1];return t=t.replace(/\B(?=(\d{3})+(?!\d))/g,"."),t+","+u+" %"}function formatoEuro(n){const t=parseFloat(n);return isNaN(t)?"—":`${t.toFixed(2)} €`}function formatDateToDDMMYYYY(n){if(!n)return"";var t=new Date(n),i=("0"+t.getDate()).slice(-2),r=("0"+(t.getMonth()+1)).slice(-2),u=t.getFullYear();return`${i}/${r}/${u}`}function formatDateToDDMMYYYY_Proveedores(n){if(!n)return"";const i=/\/Date\((\d+)\)\//.exec(n);if(i){const t=parseInt(i[1]),n=new Date(t),r=("0"+n.getDate()).slice(-2),u=("0"+(n.getMonth()+1)).slice(-2),f=n.getFullYear();return`${r}/${u}/${f}`}const t=new Date(n);if(isNaN(t))return"";const r=("0"+t.getDate()).slice(-2),u=("0"+(t.getMonth()+1)).slice(-2),f=t.getFullYear();return`${r}/${u}/${f}`}function parseDotNetDateToDDMMYYYY(n){if(!n)return"";const i=/\/Date\((\d+)\)\//.exec(n);if(!i)return"";const r=parseInt(i[1]),t=new Date(r),u=("0"+t.getDate()).slice(-2),f=("0"+(t.getMonth()+1)).slice(-2),e=t.getFullYear();return`${e}-${f}-${u}`}function formatDateInputForDateField(n){if(!n)return"";const t=new Date(n),i=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),u=t.getFullYear();return`${u}-${r}-${i}`}function toISODate(n){if(!n)return null;const t=new Date(n);return t.toISOString()}function obtenerMensajeErrorAjax(n){try{if(n.responseJSON?.message)return n.responseJSON.message;if(n.responseJSON?.Message)return n.responseJSON.Message;if(n.responseText&&n.getResponseHeader("Content-Type")?.includes("application/json")){const t=JSON.parse(n.responseText);return t.message||t.Message||"Error sin mensaje"}if(n.responseText&&!n.responseText.includes("<!DOCTYPE html>"))return n.responseText}catch(t){console.warn("Error al interpretar el error del servidor:",t)}return"Error desconocido del servidor."}function obtenerMensajeErrorAjax(n,t,i){let r="";try{const t=n.responseJSON;if(t)r=t.message||t.Message||t.error||t.Error||t.exceptionMessage||t.ExceptionMessage||"";else if(n.responseText&&n.getResponseHeader("Content-Type")?.includes("application/json")){const t=JSON.parse(n.responseText);r=t.message||t.Message||t.error||t.Error||t.exceptionMessage||t.ExceptionMessage||""}}catch(u){console.warn("Error parseando el JSON de error:",u)}if(r||!n.responseText||n.responseText.includes("<!DOCTYPE html>")||(r=n.responseText),i&&(r=r?`${r} — ${i}`:i),n.status){const t=`${n.status} ${n.statusText}`;r=r?`${r} (${t})`:t}return r||"Error desconocido del servidor."}function validarCampo(n,t,i){const r=$(n).val();r?$(n).removeClass("is-invalid"):($(n).addClass("is-invalid"),i.push(t))}function limpiarCampos(n){n.forEach(n=>{$(n).val("").removeClass("is-invalid")})}function resaltarFilaPorId(n){const t=$(`#${n}`);t.length&&(t.find("td").css("background-color","#ffff99"),setTimeout(()=>{t.find("td").css("background-color","")},1500),sessionStorage.removeItem("ultimaFilaEditada"))}function cargarComboGenerico(n,t,i,r,u=false,f="Seleccione"){return new Promise((e,o)=>{$.ajax({url:n,type:"GET",dataType:"json",success:function(n){let o=$(t);o.empty();u&&o.append(`<option value="">${f}</option>`);n.forEach(n=>{o.append(`<option value="${n[i]}">${n[r]}</option>`)});e()},error:function(n){const t=obtenerMensajeErrorAjax(n);registrarErrorjQuery(n.status,t);o(new Error(t))}})})}function rellenarCombo(n,t,i,r){const u=$(n);u.empty();u.append(`<option value="">Seleccione</option>`);t.forEach(n=>{u.append(`<option value="${n[i]}">${n[r]}</option>`)})}function tienePermiso(n){let t=sessionStorage.getItem("permisos"),i=JSON.parse(t);return!i.find(t=>t.SPO_SOP_Id===n&&t.SPO_SPE_Id===0)}function mostrarToast(n,t){Swal.fire({toast:!0,position:"top",icon:t,title:n,showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}function htmlEscape(n){return n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}