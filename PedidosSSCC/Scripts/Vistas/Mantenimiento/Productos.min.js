function abrirModal(n){let t=JSON.parse(n.getAttribute("data-producto"));$("#productoId").val(t.PR3_Id);$("#productoNombre").val(t.PR3_Nombre);$("#productoActivo").prop("checked",t.PR3_Activo);$("#productoNombre").removeClass("is-invalid");$("#modalProducto").modal("show")}async function eliminarProductoAjax(n){try{const t=await $.ajax({url:AppConfig.urls.EliminarProducto,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({idProducto:n}),dataType:"json"});t.success?(sessionStorage.removeItem("combo_productos_d365"),mostrarToast(AppConfig.mensajes.operacionOk,TipoToast.Success),$("#table").DataTable().ajax.reload(null,!1)):mostrarToast("No se puede eliminar el producto. Tiene relaciones",TipoToast.Warning)}catch(t){registrarErrorjQuery(t.status||"",t.message||t)}}function eliminarProducto(n){let t=JSON.parse(n.getAttribute("data-producto"));mostrarAlertaConfirmacion({titulo:`¿Estás seguro de que deseas eliminar el producto '${t.PR3_Nombre}'?`,onConfirmar:()=>eliminarProductoAjax(t.PR3_Id)})}$(document).ready(function(){function i(){let t=localStorage.getItem(n);t&&(t=JSON.parse(t),$("#formBuscar").val(t.general));t?.activo!==undefined&&$("#filterActivo").val(t.activo);r()}function t(){let t=$("#formBuscar").val(),i=$("#filterActivo").val(),r={general:t,activo:i};localStorage.setItem(n,JSON.stringify(r))}function r(){let n=inicializarDataTable("#table",{ajax:{url:AppConfig.urls.ObtenerProductosD365,type:"GET",dataSrc:""},columns:[{data:"PR3_Id",title:"Id"},{data:"PR3_Nombre",title:"Descripción"},{data:"PR3_Activo",visible:!1,searchable:!0},{className:"dt-center ico-status",data:null,title:"Activo",orderable:!1,render:function(n,t,i,r){return`
                            <input type="checkbox" class="form-check-input"
                                id="checkbox-${r.row}"
                                data-index="${r.row}"
                                data-id="${i.PR3_Id}" disabled
                                ${i.PR3_Activo?"checked":""} />
                        `}},{className:"td-btn",data:null,title:'<span class="sReader">Acción<\/span>',responsivePriority:2,orderable:!1,render:function(n,t,i){return`
                            <button type="button" class="btn btn-icon btn-editar btn-outline-secondary"
                                    data-producto="${JSON.stringify(i).replace(/"/g,"&quot;")}"
                                    data-*
                                    onclick="abrirModal(this)">
                                <i class="bi bi-pencil-square" title="Editar"></i>
                            </button>
                            <button type="button" class="btn btn-icon btn-eliminar btn-outline-secondary"
                                    data-producto="${JSON.stringify(i).replace(/"/g,"&quot;")}"
                                    onclick="eliminarProducto(this)">
                                <i class="bi bi-trash" title="Eliminar"></i>
                            </button>`}}]},[1,2],"export_productos");$(window).resize(function(){n.columns.adjust().draw()});$("#formBuscar").on("keyup input",function(){n.search(this.value,!1,!1).draw();n.responsive.recalc();n.columns.adjust();n.draw(!1);t()});$("#filterActivo").on("change",function(){let n=$(this).val();$("#table").DataTable().column(2).search(n).draw();t()})}let n="datatable_filters_tablaProductos";VerificarSesionActiva(OpcionMenu.ProductosD365).then(()=>{i()});$("#btnNuevo").on("click",function(){$("#productoId").val("");$("#productoNombre").val("");$("#productoActivo").prop("checked",!1);$("#productoNombre").removeClass("is-invalid");$("#modalProducto").modal("show")});$("#btnGuardar").on("click",function(){let n=$("#productoNombre").val().trim(),t=[];if(n?$("#productoNombre").removeClass("is-invalid"):($("#productoNombre").addClass("is-invalid"),t.push("Descripción")),t.length>0){mostrarToast(`@Resources.Toast_CamposObligatoriosGeneral`,TipoToast.Warning);return}let i={PR3_Id:$("#productoId").val(),PR3_Nombre:n,PR3_Activo:$("#productoActivo").is(":checked")};$.ajax({url:AppConfig.urls.GuardarProducto,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(i),dataType:"json"}).done(function(n){if(n.success){sessionStorage.removeItem("combo_productos_d365");mostrarToast(AppConfig.mensajes.operacionOk,TipoToast.Success);$("#modalProducto").modal("hide");let n=$("#table").DataTable();n.ajax.reload(null,!1)}else mostrarToast(n.message||"Error al guardar",TipoToast.Error)}).fail(function(n){const t=obtenerMensajeErrorAjax(n);registrarErrorjQuery(n.status,t)})})});