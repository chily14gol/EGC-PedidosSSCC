function editarConfiguracion(n){let t=JSON.parse(n.getAttribute("data-config"));$("#idConfiguracion").val(t.CFG_Id);$("#descripcion").val(t.CFG_Descripcion).prop("disabled",!1);$("#valor").val(t.CFG_Valor).prop("disabled",!1);$("#descripcion").removeClass("is-invalid");$("#valor").removeClass("is-invalid");$("#modalEditarLabel").text("Editar Configuración");$("#modalEditar").modal("show")}function eliminarConfiguracion(n){let t=JSON.parse(n.getAttribute("data-config"));mostrarAlertaConfirmacion({titulo:`¿Estás seguro de que deseas eliminar la configuración '${t.CFG_Descripcion}'?`,onConfirmar:async()=>{try{const n=await $.ajax({url:AppConfig.urls.eliminarConfiguracion,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({idConfiguracion:t.CFG_Id}),dataType:"json"});if(n.success){mostrarToast(AppConfig.mensajes.operacionOk,TipoToast.Success);let n=$("#table").DataTable();n.ajax.reload(null,!1)}else registrarErrorjQuery(n.status,n.message)}catch(n){registrarErrorjQuery(n.status||"Error",n.message||n)}}})}const guardarConfiguracion=async()=>{try{let n=$("#idConfiguracion").val(),t=$("#descripcion").val(),i=$("#valor").val(),r=[];if(t?$("#descripcion").removeClass("is-invalid"):($("#descripcion").addClass("is-invalid"),r.push("descripcion")),i?$("#valor").removeClass("is-invalid"):($("#valor").addClass("is-invalid"),r.push("valor")),r.length>0){mostrarToast(AppConfig.mensajes.camposObligatorios,TipoToast.Warning);return}if(n=="1"&&!/^\d+$/.test(i)){mostrarToast("El valor debe ser un año.",TipoToast.Warning);return}let e=$("#table").DataTable(),f=!1;if(e.rows().every(function(){let i=this.data();if(i.CFG_Id!=n&&i.CFG_Descripcion.toLowerCase()===t.toLowerCase())return f=!0,!1}),f){$("#descripcion").addClass("is-invalid");mostrarToast("La descripción ya existe en el sistema.",TipoToast.Error);return}$("#descripcion").removeClass("is-invalid");let o={CFG_Id:n==""?0:n,CFG_Descripcion:t,CFG_Valor:i};const u=await $.ajax({url:AppConfig.urls.guardarConfiguracion,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(o),dataType:"json"});if(u.success){mostrarToast(AppConfig.mensajes.operacionOk,TipoToast.Success);$("#modalEditar").modal("hide");const n=$("#table").DataTable();n.ajax.reload(null,!1)}else registrarErrorjQuery(u.status,u.message)}catch(n){registrarErrorjQuery("Error",n.message||n)}};$(document).ready(function(){function n(){let n=inicializarDataTable("#table",{ajax:{url:AppConfig.urls.obtenerConfiguraciones,type:"GET",dataSrc:""},columns:[{data:"CFG_Id",title:"Id"},{data:"CFG_Descripcion",title:"Descripción"},{data:"CFG_Valor",title:"Valor"},{className:"td-btn",data:null,title:'<span class="sReader">Acción<\/span>',responsivePriority:2,orderable:!1,render:function(n,t,i){return`
                                        <button type="button" class="btn btn-icon btn-editar btn-outline-secondary"
                                            data-config="${JSON.stringify(i).replace(/"/g,"&quot;")}"
                                            onclick="editarConfiguracion(this)">
                                            <i class="bi bi-pencil-square" title="Editar"></i>
                                        </button>
                                        <button type="button" class="btn btn-icon btn-eliminar btn-outline-secondary"
                                            data-config="${JSON.stringify(i).replace(/"/g,"&quot;")}"
                                            onclick="eliminarConfiguracion(this)">
                                            <i class="bi bi-trash" title="Eliminar"></i>
                                        </button>`}}]},[],"export_config");$(window).resize(function(){n.columns.adjust().draw()});$("#formBuscar").on("keyup input",function(){n.search(this.value,!1,!1).draw();n.responsive.rebuild();n.responsive.recalc();n.columns.adjust();n.draw(!1);guardarFiltros()})}VerificarSesionActiva(OpcionMenu.Configuraciones).then(()=>{n()});$("#btnNuevo").on("click",function(){$("#idConfiguracion").val("");$("#descripcion").val("").prop("disabled",!1);$("#valor").val("").prop("disabled",!1);$("#descripcion").removeClass("is-invalid");$("#valor").removeClass("is-invalid");$("#modalEditarLabel").text("Agregar Configuración");$("#modalEditar").modal("show")})});