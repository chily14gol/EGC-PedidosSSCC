function editarOficina(n){let t=JSON.parse(n.getAttribute("data-oficina"));$("#idOficina").val(t.OFI_Id);$("#nombre").val(t.OFI_Nombre);$("#nombreDA").val(t.OFI_NombreDA);$("#nombre").removeClass("is-invalid");$("#modalEditarLabel").text("Editar Oficina");$("#modalOficina").modal("show")}function eliminarOficina(n){let t=JSON.parse(n.getAttribute("data-oficina"));mostrarAlertaConfirmacion({titulo:`¿Estás seguro de que deseas eliminar la oficina '${t.OFI_Nombre}'?`,onConfirmar:function(){$.ajax({url:AppConfig.urls.EliminarOficina,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({idOficina:t.OFI_Id}),dataType:"json"}).done(function(n){if(n.success){mostrarToast(AppConfig.mensajes.operacionOk,TipoToast.Success);let n=$("#tableOficinas").DataTable();n.ajax.reload(null,!1)}else registrarErrorjQuery(n.status,n.message)}).fail(function(n){const t=obtenerMensajeErrorAjax(n);registrarErrorjQuery(n.status,t)})}})}function validarCampoTexto(n,t){const i=$(n).val().trim();return i?($(n).removeClass("is-invalid"),null):($(n).addClass("is-invalid"),t)}const guardarOficina=async()=>{let t=$("#idOficina").val(),i=$("#nombre").val().trim(),r=$("#nombreDA").val().trim();const u=[validarCampoTexto("#nombre","Nombre"),validarCampoTexto("#nombreDA","Nombre DA")].filter(Boolean);if(u.length>0){mostrarToast(AppConfig.mensajes.camposObligatorios,TipoToast.Warning);return}const f={OFI_Id:t,OFI_Nombre:i,OFI_NombreDA:r};try{const n=await $.ajax({url:AppConfig.urls.GuardarOficina,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(f),dataType:"json"});if(n.success){mostrarToast(AppConfig.mensajes.operacionOk,TipoToast.Success);$("#modalOficina").modal("hide");let n=$("#tableOficinas").DataTable();n.ajax.reload(null,!1)}else mostrarToast("Ya existe una oficina con el mismo Nombre o Nombre DA",TipoToast.Warning)}catch(n){const t=obtenerMensajeErrorAjax(n);registrarErrorjQuery(n.status,t)}};$(document).ready(function(){function i(){let t=localStorage.getItem(n),i=!1;if(t){t=JSON.parse(t);$("#formBuscar").val(t.general);$("#filterNombre").val(t.nombre||"");$("#filterNombreDA").val(t.nombreDA||"");let{...otrosFiltros}=t;i=Object.values(otrosFiltros).some(n=>n)}r();setTimeout(function(){let n=$("#tableOficinas").DataTable();t?.general&&n.search(t.general,!1,!1).draw()},200);i&&($("#btnLimpiar").show(),$(".table-filter").addClass("advance"),$("#btnAvanzado").html(`Ocultar Filtros`))}function t(){let t={general:$("#formBuscar").val(),nombre:$("#filterNombre").val(),nombreDA:$("#filterNombreDA").val()};localStorage.setItem(n,JSON.stringify(t))}function r(){let n=inicializarDataTable("#tableOficinas",{ajax:{url:AppConfig.urls.ObtenerOficinas,type:"GET",dataSrc:"",error:function(n){const t=obtenerMensajeErrorAjax(n);registrarErrorjQuery(n.status,t)}},columns:[{data:"OFI_Nombre",title:"Nombre"},{data:"OFI_NombreDA",title:"Nombre DA"},{className:"td-btn",data:null,title:'<span class="sReader">Acción<\/span>',responsivePriority:2,orderable:!1,render:function(n,t,i){const r=JSON.stringify(i).replace(/"/g,"&quot;");return`<div class="btn-group" role="group">
                            <button type="button" class="btn btn-icon btn-editar btn-outline-secondary me-2" title="Editar"
                                data-oficina="${r}"
                                onclick="editarOficina(this)">
                                <i class="bi bi-pencil-square"></i>
                            </button>
                            <button type="button" class="btn btn-icon btn-eliminar btn-outline-secondary" title="Eliminar"
                                data-oficina="${r}"
                                onclick="eliminarOficina(this)">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>`}}]},[],"export_oficinas");$(window).resize(function(){n.columns.adjust().draw()});$("#formBuscar").on("keyup input",function(){n.search(this.value,!1,!1).draw();n.responsive.rebuild();n.responsive.recalc();n.columns.adjust();n.draw(!1);t()})}const n="datatable_filters_tablaOficinas";VerificarSesionActiva(OpcionMenu.Oficinas).then(()=>{i()});$("#btnNuevaOficina").on("click",function(){$("#idOficina").val("-1");$("#nombre").val("");$("#nombreDA").val("");$("#nombre").removeClass("is-invalid");$("#modalEditarLabel").text("Agregar Oficina");$("#modalOficina").modal("show")});$("#btnBuscar").on("click",function(){let i=$("#filterNombre").val(),r=$("#filterNombreDA").val(),n=$("#tableOficinas").DataTable();n.columns(0).search(i).draw();n.columns(1).search(r).draw();t()});$("#modalOficina").modal({backdrop:"static",keyboard:!1})});